<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Home - Documentation</title>

    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc.css">
</head>
<body>

<a href="https://github.com/maxkoryukov/passport-wix-app" class="github-corner" aria-label="View source on Github"><svg width="80" height="80" viewBox="0 0 250 250" style="fill:#151513; color:#fff; position: absolute; top: 0; border: 0; right: 0;" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="Strategy.html">Strategy</a><ul class='methods'><li data-type='method'><a href="Strategy.html#authenticate">authenticate</a></li></ul></li></ul>
</nav>

<div id="main">



















    <section class="readme">
        <article><h1 id="passport-wix-app">passport-wix-app</h1>
<p><a href="https://travis-ci.org/maxkoryukov/passport-wix-app"><img src="https://travis-ci.org/maxkoryukov/passport-wix-app.svg?branch=master" alt="Build Status"></a>
<a href="https://www.npmjs.com/package/passport-wix-app"><img src="https://img.shields.io/npm/v/passport-wix-app.svg" alt="npm version"></a></p>
<p><a href="https://codecov.io/gh/maxkoryukov/passport-wix-app"><img src="https://codecov.io/gh/maxkoryukov/passport-wix-app/branch/master/graph/badge.svg" alt="codecov"></a>
<a href="https://www.bithound.io/github/maxkoryukov/passport-wix-app"><img src="https://www.bithound.io/github/maxkoryukov/passport-wix-app/badges/score.svg" alt="bitHound Overall Score"></a>
<a href="https://www.bithound.io/github/maxkoryukov/passport-wix-app/master/dependencies/npm"><img src="https://www.bithound.io/github/maxkoryukov/passport-wix-app/badges/dependencies.svg" alt="bitHound Dependencies"></a>
<a href="https://www.npmjs.com/package/passport-wix-app"><img src="https://img.shields.io/npm/dm/passport-wix-app.svg" alt="npm downloads"></a></p>
<p><a href="https://www.gittip.com/maxkoryukov/"><img src="http://img.shields.io/gittip/maxkoryukov.png" alt="Tips"></a></p>
<p>Wix Application authentication strategy for Passport.</p>
<p><em>Useful helper for Wix Application developers</em></p>
<h2 id="install">Install</h2>
<pre class="prettyprint source lang-bash"><code>$ npm install -S passport-wix-app</code></pre><h2 id="usage">Usage</h2>
<p>This module parses <code>instance</code> parameter passed by Wix Applications
(<a href="http://dev.wix.com/docs/infrastructure/app-instance/">see documentation üåê</a>)</p>
<p>Wix sends several other parameters (not only <code>instance</code>). You could get their
values straight from the original request. Just pass <code>passReqToCallback: true</code>
among other Strategy options.</p>
<p>Additional request's parameters depend on Wix Application type. Read more on the
official Wix-Dev site:</p>
<ul>
<li>for <a href="http://dev.wix.com/docs/development/widget/#endpoint-urls">widget üåê</a></li>
<li>for <a href="http://dev.wix.com/docs/development/page/#endpoint-urls">page üåê</a></li>
</ul>
<h3 id="configure-strategy">Configure Strategy</h3>
<p>The <code>wix-app</code> authentication strategy authenticates a user using <code>instance</code>
parameter, <a href="http://dev.wix.com/docs/infrastructure/app-instance/">passed by Wix üåê</a>.</p>
<p>The strategy requires <code>options</code> and  <code>verify</code> callback.</p>
<pre class="prettyprint source lang-javascript"><code>passport.use(new WixAppStrategy({&quot;secret&quot;: &quot;WIX-APP-SECRET&quot;},
  function verifyCallback (instance, done) {

    // any user-verification logic
    // ...
    // here is an example:
    User.findOne({
      application: instance.instanceId,
      userId: instance.uid
    }, function (err, user) {
      // error during verification
      if (err) { return done(err) }

      // user is not found/not authenticated
      if (!user) { return done(null, false) }

      // success:
      return done(null, user)
    })
  }
))</code></pre><h4 id="options">Options</h4>
<p>You can pass additional options to the <code>WixAppStrategy</code> constructor:</p>
<pre class="prettyprint source lang-js"><code>new WixAppStrategy(options, callback)</code></pre><p>The available options are:</p>
<ul>
<li><code>passReqToCallback</code> - determines whether to pass the incoming request (<code>req</code>)
  to the verify callback</li>
<li><code>secret</code> - Optional, defaults to <code>null</code>. Defines the secret assigned to your
  Wix Application.
  <em>Note</em> that you can omit <code>secret</code> on a <em>configuration</em> step and pass
  <code>secret</code> on request handling, when the app will call
  <code>passport.authenticate()</code> method.</li>
</ul>
<h4 id="verification-callback">Verification callback</h4>
<p>Verification callback will be called with several params (see
<code>passReqToCallback</code> in options-section):</p>
<ul>
<li><code>req</code> - <strong>optional</strong> incoming <a href="(http://expressjs.com/)">Express-request üåê</a> (will be passed if
  <code>passReqToCallback</code> option is set to <code>true</code>)</li>
<li><code>instance</code> - parsed <a href="http://dev.wix.com/docs/infrastructure/app-instance/">Wix-Instance üåê</a></li>
<li><code>callback</code> - <code>passport-done</code> function</li>
</ul>
<h5 id="parsed-instance">Parsed Instance</h5>
<p>Example of parsed instance (taken from
<a href="http://dev.wix.com/docs/infrastructure/app-instance/#json-example">Wix-documentation üåê</a>
and extended with custom fields - <code>ext</code>):</p>
<pre class="prettyprint source lang-js"><code>parsedInstance = {
    &quot;instanceId&quot;:       &quot;bf296da1-75ce-48e6-9f72-14b7148d4fa2&quot;,
    &quot;signDate&quot;:         &quot;2015-12-10T06:57:37.201Z&quot;,
    &quot;uid&quot;:              &quot;da32cbf7-7f8b-4f9b-a97e-e67f3072ce92&quot;,
    &quot;permissions&quot;:      &quot;OWNER&quot;,
    &quot;ipAndPort&quot;:        &quot;91.199.119.13/35734&quot;,
    &quot;vendorProductId&quot;:  null,
    &quot;originInstanceId&quot;: &quot;c38e4e00-dcc1-433e-9e90-b332def7b342&quot;,
    &quot;siteOwnerId&quot;:      &quot;da32cbf7-7f8b-4f9b-a97e-e67f3072ce92&quot;,

    // additional params:
    &quot;ext&quot;: {
        &quot;ip&quot;:           &quot;91.199.119.13&quot;,
        &quot;port&quot;:         35734,
        &quot;signDate&quot;:     new Date(2015, 11, 10, 06, 57, 37, 201)
    },
}</code></pre><h3 id="authenticate-requests">Authenticate Requests</h3>
<p>Use <code>passport.authenticate()</code>, specifying the <code>'wix-app'</code> strategy, to authenticate requests.</p>
<p>For example, as route middleware in an <a href="(http://expressjs.com/)">Express üåê</a> application:</p>
<pre class="prettyprint source lang-js"><code>app.post('/login',
  passport.authenticate('wix-app', { failureRedirect: '/login' }),
  function(req, res) {
    res.redirect('/');
  });</code></pre><p>Or, with late-loaded secret:</p>
<pre class="prettyprint source lang-js"><code>app.post('/login',
  passport.authenticate('wix-app', {
    secret: 'secret-key',
    failureRedirect: '/login'
  }),
  function(req, res) {
    res.redirect('/');
  });</code></pre><h2 id="credits">Credits</h2>
<p>The <a href="https://github.com/jaredhanson/passport-local">passport-local üåê</a>
(by Jared Hanson) was used as a scaffold for this module.</p>
<h2 id="license">License</h2>
<p>Please, read the <a href="LICENSE"><code>LICENSE</code></a> file in the root of the repository
(or downloaded package).</p></article>
    </section>






</div>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.5.4</a> on Mon Aug 07 2017 03:22:40 GMT+0500 (+05) using the <a href="https://github.com/clenemt/docdash">docdash</a> theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/linenumber.js"></script>
</body>
</html>
